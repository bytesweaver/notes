##  网络分层

![1556353984572](.\image\网络分层.png)

TCP/IP各层作用

1. 应用层
   决定了向用户提供应用服务时通信的活动
   TCP/IP 协议族内预存了各类通用的应用服务。比如，FTP（File Transfer Protocol，文件传输协议）和 DNS（Domain Name System，域 名系统）服务就是其中两类。
   HTTP 协议也处于该层。

2. 传输层
   提供处于网络连接中的两台计算机的数据传输
   在传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议）和 UDP（User Data Protocol，用户数据报 协议）。

3. 网络层
   网络层用来处理在网络上流动的数据包
   数据包是网络传输的最小数 据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计 算机，并把数据包传送给对方。

4. 网络接口层

   用来处理连接的硬件部分

   包括控制操作系统、硬件的设备驱 动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等 物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在 链路层的作用范围之内。

   **各个协议的关系 **

   ![img](image\协议之间的关系.jpg)

   ## 报文结构

   请求报文的组成

   ![img](image\请求报文.jpg)

   响应报文的组成

   ![img](image\响应报文.jpg)

   ## 状态码

   ![1559605600930](image\状态码.png)

   ```
   200 #OK
   204 #No Content 请求处理成功，但没有资源返回
   206 #Partition Content 部分请求
   301 #Moved Permanently 永久性重定向
   302 #Found 临时重定向
   303 #See Other 同302，明确表示客户端应该采用GET方法获取资源
   304 #Not Modified
   #客户端发送附带条件的请求时，请求的资源不符合条件。和重定向无关
   307 #Temporary Redirect，同302 遵守浏览器标准，不会从POST变成GET
   400 #Bad Request 你吧，需修改内容再次发送请求
   401 #Unauthorized 该状态码表示发送的请求需要有HTTP认证的认证信息
   403 #Forbidden 权限问题
   404 #Not Found 服务器上没有请求的资源
   500 #Internal Server Error 服务器存在BUG或者临时故障
   503 #Service Unavailable
   ```

   

   ## URI和URL

   URL：统一资源定位符，URL是URI的子集

![URI](image\uri.jpg)

## 通信数据转发程序

1. 代理

   ![1559608422487](image\代理服务器.png)

   代理有多种使用方法，按两种基准分类。一种是是否使用缓存，另一种是是否修改报文

   1. 缓存代理

      缓存代理（Caching Proxy）会预先将资源的副本（缓存）保存在代理服务器上。当代理再次接收到对相同资源的请求时，就可以不从源服务器那里获取资源，而是将之前缓存的资源作为响应返回 

   2. 透明代理

      转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理（Transparent Proxy）。反之，对报文内容进行加工的代理被称为非透明代理 

2. 网关

   网关的工作机制和代理十分相似。而网关能使通信线路上的服务器提供非 HTTP 协议服务 

   ![1559608712804](image\网关.png)

3. 隧道

   隧道可按要求建立起一条与其他服务器的通信线路，届时使用 SSL 等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信 

![1559608795091](image\隧道.png)

>  在相同的 IP 地址下，由于虚拟主机可以寄存多个不同主机名和域名的 Web 网站，因此在发送 HTTP 请求
> 时，必须在 Host 首部内完整指定主机名或域名的 URI。 

## HTTPS

![1559610021695](image\https.png)

所谓 HTTPS，其实就是身披 SSL 协议这层外壳的 HTTP 

![1559610103174](image\https结构.png)

https采用混合加密机制，公开秘钥加密效率较低，共享秘钥，秘钥可能被截取

![1559610156106](image\混合加密机制.png)

共享秘钥，以共享密钥方式加密时必须将密钥也发给对方。 

![1559610468410](image\共享秘钥.png)

公开密钥加密，私钥解密

![1559610553923](image\公开秘钥.png)

通过证书确认身份

![1559610657661](image\数字证书.png)

![http通行过程](image\建立HTTPS通信过程.png)

## 认证方式

HTTP/1.1使用的认证方式

1. BASIC 认证（基本认证）
2. DIGEST 认证（摘要认证）
3. SSL 客户端认证
4. FormBase 认证（基于表单认证） 

![1559611399496](image\Basic认证.png)

![1559611453226](image\digst认证.png)  

SSL客户端认证

步骤 1： 接收到需要认证资源的请求，服务器会发送 Certificate Request 报文，要求客户端提供客户端证
书。
步骤 2： 用户选择将发送的客户端证书后，客户端会把客户端证书信息以 Client Certificate 报文方式发送给
服务器。 

步骤 3： 服务器验证客户端证书验证通过后方可领取证书内客户端的公开密钥，然后开始 HTTPS 加密通
信。 

![1559611743163](image\Session管理.png)

## 消除HTTP瓶颈的SPDY

为了尽可能实时地显示这些更新的内容，服务器上一有内容更新，就需要直接把那些内容反馈到客户端的界
面上

 ![1559648750307](image\以前http通信过程.png)

![1559648814053](image\Ajax通信.png)

![1559648856125](image\commit通信.png)

![1559648919822](image\web_socket通信.png)

## 与Http协作的web服务器

在相同的 IP 地址下， 由于虚拟主机可以寄存多个不同主机名和域名的 Web 网站， 因此在发送 HTTP 请求时， 必须在 Host 首部内完整指定主机名或域名的 URI  

通信数据转发程序：

1. 代理

   接收由客户端发送的请求并转发给服务器， 同时也接收服务器返回的响应并转发给客户端  

2. 网关

   网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时， 它就像自己拥有资源的源服务器一样对请求进行处理  

3. 隧道

   隧道是在相隔甚远的客户端和服务器两者之间进行中转， 并保持双方通信连接的应用程序  